<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Admin de Ítems</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-4">
        <h2 class="text-primary mb-4">⚙️ Admin de Ítems</h2>
        <div class="row mb-3">
            <div class="col-md-6">
                <h5>Carnes</h5>
                <div class="input-group mb-2">
                    <input type="text" id="nuevaCarne" class="form-control" placeholder="Nueva carne">
                    <button class="btn btn-success" onclick="agregarItem('carne')">Agregar</button>
                </div>
            </div>
            <div class="col-md-6">
                <h5>Extras</h5>
                <div class="input-group mb-2">
                    <input type="text" id="nuevoExtra" class="form-control" placeholder="Nuevo extra">
                    <button class="btn btn-success" onclick="agregarItem('extra')">Agregar</button>
                </div>
            </div>
        </div>

        <div id="tablaItems" class="mt-4">
            <table class="table table-bordered">
                <thead class="table-secondary">
                    <tr>
                        <th>Carnes</th>
                        <th>Extras</th>
                    </tr>
                </thead>
                <tbody id="tablaBody">
                </tbody>
            </table>
        </div>

        <button class="btn btn-primary mt-3" onclick="guardarCambios()">
            💾 Guardar Cambios
        </button>
    </div>

<script>
    const API_URL = '/api-items-asado';
    let carnes = [];
    let extras = [];

    function fetchItems() {
        fetch(API_URL)
            .then(res => res.json())
            .then(data => {
                carnes = data.carnes || [];
                extras = data.extras || [];
                renderTabla();
            })
            .catch(err => console.error("Error al obtener ítems:", err));
    }

    function agregarItem(tipo) {
        const input = tipo === 'carne' ? document.getElementById('nuevaCarne') : document.getElementById('nuevoExtra');
        const valor = input.value.trim();
        if (!valor) return;
        if (tipo === 'carne') carnes.push(valor);
        else extras.push(valor);
        input.value = '';
        renderTabla();
    }

    function eliminarItem(tipo, nombre) {
        fetch(`${API_URL}?tipo=${tipo}&nombre=${encodeURIComponent(nombre)}`, {
            method: 'DELETE'
        })
        .then(res => {
            if (res.ok) {
                if (tipo === 'carne') carnes = carnes.filter(c => c !== nombre);
                else extras = extras.filter(e => e !== nombre);
                renderTabla();
            } else {
                alert('Error al eliminar ítem.');
            }
        })
        .catch(err => alert('Error de red al eliminar ítem.'));
    }

    function renderTabla() {
        const tbody = document.getElementById('tablaBody');
        tbody.innerHTML = '';
        const maxLen = Math.max(carnes.length, extras.length);
        for (let i = 0; i < maxLen; i++) {
            const carne = carnes[i] || '';
            const extra = extras[i] || '';
            const row = `<tr>
                <td>
                    ${carne}
                    ${carne ? `<button class="btn btn-sm btn-outline-danger float-end" onclick="eliminarItem('carne', '${carne}')">🗑️</button>` : ''}
                </td>
                <td>
                    ${extra}
                    ${extra ? `<button class="btn btn-sm btn-outline-danger float-end" onclick="eliminarItem('extra', '${extra}')">🗑️</button>` : ''}
                </td>
            </tr>`;
            tbody.innerHTML += row;
        }
    }

    function guardarCambios() {
        const body = {
            carnes: carnes,
            extras: extras
        };
        fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(body)
        })
        .then(res => {
            if (res.ok) {
                alert('Cambios guardados correctamente.');
            } else {
                alert('Error al guardar cambios.');
            }
        })
        .catch(err => alert('Error de red al guardar cambios.'));
    }

    document.addEventListener("DOMContentLoaded", fetchItems);
</script>
</body>
</html>
